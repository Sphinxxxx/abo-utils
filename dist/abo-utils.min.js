/*!
 * abo-utils v0.3.4
 * https://github.com/Sphinxxxx/abo-utils
 *
 * Copyright 2021 Andreas Borgen
 * Released under the MIT license.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.ABOUtils={})}(this,function(e){"use strict";function i(e,t){e=(t=t||document).querySelectorAll(e);return Array.from(e)}function t(e,t){return(t=t||document).querySelector(e)}var n=t;function o(e,t){if(e&&t)return e.nodeName.toLowerCase()===t.toLowerCase()}function r(e,t,n){var r=e.split(/([#\.])/);if(1<r.length){e=r[0]||"div",n=n||{};for(var a=1;a<r.length-1;a++){var o=r[a],i=r[a+1];"#"===o?n.id=i:n.class=n.class?n.class+" "+i:i,a++}}var c="svg"===e.toLowerCase()?"http://www.w3.org/2000/svg":t?t.namespaceURI:null,u=c?document.createElementNS(c,e):document.createElement(e);if(n)for(var l in n)u.setAttribute(l,n[l]);return t&&t.appendChild(u),u}function c(e,t,n){e.addEventListener(t,n,!1)}function a(e,n,r){r=r||{};function t(e){var t;e&&(e=Array.from(e),(e=(t=r.acceptedTypes)?e.filter(function(e){return t.includes(e.type)}):e).length&&(e=e.map(a),n(e)))}function a(e){return{url:URL.createObjectURL(e),file:e}}o(e,"INPUT")&&"file"===e.type?c(e,"change",function(e){e=e.currentTarget;e.files&&t(e.files)}):(c(e,"dragover",function(e){return e.preventDefault()}),c(e,"drop",function(e){e.preventDefault(),t(e.dataTransfer.files)}))}function u(t){return function(e){t(e[0])}}var l=Object.freeze({$$:i,$:n,$$1:t,selectors:function(){return[n,i]},walkNodeTree:function(e,t){for(var n,r=(t=t||{}).inspect||function(e){return!0},a=t.collect||function(e){return!0},o=document.createTreeWalker(e,NodeFilter.SHOW_ALL,{acceptNode:function(e){return r(e)?a(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:NodeFilter.FILTER_REJECT}}),i=[];n=o.nextNode();)t.callback&&t.callback(n),i.push(n);return i},nodeName:o,createElement:r,relativeMousePos:function(e,t,n){function r(e,t,n){return Math.max(t,Math.min(e,n))}var a=t.getBoundingClientRect(),t=e.clientX-a.left,e=e.clientY-a.top;return n&&(t=r(t,0,a.width),e=r(e,0,a.height)),[t,e]},addEvent:c,live:function(e,a,o){document.addEventListener(e,function(e){var t=i(a);if(t&&t.length){for(var n=e.target,r=-1;n&&-1===(r=t.indexOf(n));)n=n.parentElement;-1<r&&o.call(n,e)}})},animate:function(r,a,o){var i=void 0,c=void 0;return requestAnimationFrame(function e(t){var n=(t-(i=i||t))/r,t=n%1;o&&Math.trunc(n)%2&&(t=1-t),a(t,n),c||requestAnimationFrame(e)}),{cancel:function(){c=!0}}},dropFiles:a,dropFile:function(e,t){a(e,u(t))},dropImage:function(e,t){a(e,u(t),{acceptedTypes:["image/png","image/jpeg","image/gif","image/svg","image/svg+xml"]})}});function s(e,t,n){e[t]||Object.defineProperty(e,t,{value:n})}s(Array,"from",function(e){return Array.prototype.slice.call(e)}),s(Math,"trunc",function(e){return e<0?Math.ceil(e):Math.floor(e)}),s(Number,"isNaN",function(e){return e!=e}),s(Array.prototype,"includes",function(n,r){return(r=r||0)<0&&(r=this.length+r),this.some(function(e,t){return r<=t&&(t=e,e=n,Number.isNaN(t)?Number.isNaN(e):t===e)})});var f=Element.prototype;s(f,"matches",f.msMatchesSelector||f.webkitMatchesSelector),s(f,"closest",function(e){var t=this;do{if(t.matches(e))return t}while(t=o(t,"svg")?t.parentNode:t.parentElement);return null}),s(HTMLCanvasElement.prototype,"toBlob",function(a,o,i){var c=this;setTimeout(function(){for(var e=atob(c.toDataURL(o,i).split(",")[1]),t=e.length,n=new Uint8Array(t),r=0;r<t;r++)n[r]=e.charCodeAt(r);a(new Blob([n],{type:o||"image/png"}))})});var h=Object.freeze({});var d=Object.freeze({clamp:function(e,t,n){return Math.max(t,Math.min(e,n))},lerp:function n(e,r,a){return Array.isArray(e)?e.map(function(e,t){return n(e,r[t],a)}):(1-a)*e+a*r}});function p(e,t){var n=t[0]-e[0],e=t[1]-e[1];return Math.sqrt(n*n+e*e)}function m(e,t,n){return Math.abs((t[0]-e[0])*(n[1]-e[1])-(n[0]-e[0])*(t[1]-e[1]))/2}function v(e,t,n){var r=p(t,n),a=p(n,e),o=p(e,t),i=r+a+o,c=i/2;return{r:m(e,t,n)/c,c:[(r*e[0]+a*t[0]+o*n[0])/i,(r*e[1]+a*t[1]+o*n[1])/i]}}function g(e,t,n,r){var a=v(e,t,n),o=a.c,i=(a.r+r)/a.r;function c(e){var t=e[0]-o[0],e=e[1]-o[1];return[t*i+o[0],e*i+o[1]]}return[c(e),c(t),c(n)]}var y=Object.freeze({distance:p,rotatePoint:function(e,t,n){var r=Math.cos(t),a=Math.sin(t),o=e[0],t=e[1];return n&&(o-=n[0],t-=n[1]),e=r*o-a*t,t=a*o+r*t,n&&(e+=n[0],t+=n[1]),[e,t]},angleBetween:function(e,t,n){function r(e){return e*e}var a,o;return n?(o=((a=r(t[0]-e[0])+r(t[1]-e[1]))+(o=r(t[0]-n[0])+r(t[1]-n[1]))-(r(n[0]-e[0])+r(n[1]-e[1])))/Math.sqrt(4*a*o))<=-1?Math.PI:1<=o?0:Math.acos(o):(o=t[0]-e[0],e=t[1]-e[1],Math.atan2(e,o))},triangleArea:m,triangleIncircle:v,expandTriangle:g});function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var w=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{!r&&c.return&&c.return()}finally{if(a)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};var M=(function(e,t,n){return t&&b(e.prototype,t),n&&b(e,n),e}(T,[{key:"setPixel",value:function(e,t,n){t=4*(t*this.w+e),e=this.targetData.data;e[t]=n[0],e[1+t]=n[1],e[2+t]=n[2],e[3+t]=3<n.length?n[3]:255}},{key:"render",value:function(){this.targetContext.putImageData(this.targetData,0,0)}},{key:"sync",value:function(){this.targetData=this.targetContext.getImageData(0,0,this.w,this.h)}},{key:"clear",value:function(){this.targetContext.clearRect(0,0,this.w,this.h),this.sync()}}]),T);function T(e,t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,T),this.w=e.width=t||e.width,this.h=e.height=n||e.height,this.targetContext=e.getContext("2d"),this.sync()}var x=Object.freeze({drawImageTriangle:function(e,t,n,r,a,o,i,c,u){function l(e,t,n,r,a,o,i,c,u){var l=((o-u)*(t-a)-(n-o)*(a-c))/((r-i)*(t-a)-(e-r)*(a-c)),i=((o-u)*(e-r)-(n-o)*(r-i))/((a-c)*(e-r)-(t-a)*(r-i));return[l,i,n-e*l-t*i]}var s;u&&(f=m(o,i,c),s=m(n,r,a),u=g(o,i,c,.3),o=(u=w(u,3))[0],i=u[1],c=u[2],f=g(n,r,a,.3*s/f),n=(f=w(f,3))[0],r=f[1],a=f[2]);var f=l(n[0],n[1],o[0],r[0],r[1],i[0],a[0],a[1],c[0]),c=l(n[0],n[1],o[1],r[0],r[1],i[1],a[0],a[1],c[1]);t.save(),t.setTransform(f[0],c[0],f[1],c[1],f[2],c[2]),t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(r[0],r[1]),t.lineTo(a[0],a[1]),t.closePath(),t.clip(),t.drawImage(e,0,0,e.width,e.height),t.restore()},CanvasPixelBuffer:M}),N={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},C=/([astvzqmhlc])([^astvzqmhlc]*)/gi;f=Object.freeze({parsePath:function(e){var o=[];return e.replace(C,function(e,t,n){var r,a=t.toLowerCase();for(n=(r=(r=(r=n).replace(/(\.\d+)(?=\.)/g,"$1 ")).match(/-?[.0-9]+(?:e[-+]?\d+)?/gi))?r.map(Number):[],"m"===a&&2<n.length&&(o.push([t].concat(n.splice(0,2))),a="l",t="m"===t?"l":"L");;){if(n.length===N[a])return n.unshift(t),o.push(n);if(n.length<N[a])throw new Error("Malformed path data: "+[t,n]);o.push([t].concat(n.splice(0,N[a])))}}),o},absolutizePath:function(e){var a=0,o=0,i=0,c=0;return e.map(function(e){var t=(e=e.slice())[0],n=t.toUpperCase();if(e.startPoint={x:i,y:c},t!==n)switch(e[0]=n,t){case"a":e[6]+=i,e[7]+=c;break;case"v":e[1]+=c;break;case"h":e[1]+=i;break;default:for(var r=1;r<e.length;)e[r++]+=i,e[r++]+=c}switch(n){case"Z":i=a,c=o;break;case"H":i=e[1];break;case"V":c=e[1];break;case"M":i=a=e[1],c=o=e[2];break;default:i=e[e.length-2],c=e[e.length-1]}return e.endPoint={x:i,y:c},e})},serializePath:function(e){return e.reduce(function(e,t){return e+t[0]+t.slice(1).join(",")},"")}});function E(){var e=new Date,t=("00"+e.getMilliseconds()).substr(-3);return e.toTimeString().split(" ")[0]+"."+t}M=Object.freeze({printTime:E,log2:function(){var e="["+E()+"]",t=Array.from(arguments);t.unshift(e),console.log.apply(console,t)},alertErrors:function(){window.onerror=function(e,t,n){alert(E()+" - Error message: "+e+"\nURL: "+t+"\nLine Number: "+n)}},logToScreen:function(){var t=r("#abo-log",document.body,{style:"position:fixed;top:0;left:0;z-index:9999;white-space:pre;pointer-events:none;background-color:rgba(255,255,255,.5);"});console._log=console.log,console.log=function(){var e=Array.from(arguments).join(" ");t.textContent=e+"\n"+t.textContent}}});e.Polys=h,e.Math=d,e.Geom=y,e.DOM=l,e.Canvas=x,e.SVG=f,e.Debug=M,e.htmlEncode=function(e){return document.createElement("a").appendChild(document.createTextNode(e)).parentNode.innerHTML},e.htmlDecode=function(e){var t=document.createElement("a");return t.innerHTML=e,t.textContent},e.getQueryVariable=function(e){for(var t=window.location.search.substring(1).split("&"),n=0;n<t.length;n++){var r=t[n].split("=");if(r[0]===e)return r[1]}return!1},Object.defineProperty(e,"__esModule",{value:!0})});