/*!
 * abo-utils v0.3.1
 * https://github.com/Sphinxxxx/abo-utils
 *
 * Copyright 2018 Andreas Borgen
 * Released under the MIT license.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.ABOUtils={})}(this,function(e){"use strict";function t(e,t,n){e[t]||Object.defineProperty(e,t,{value:n})}t(Array,"from",function(e){return Array.prototype.slice.call(e)}),t(Math,"trunc",function(e){return e<0?Math.ceil(e):Math.floor(e)}),t(Number,"isNaN",function(e){return e!=e}),t(Array.prototype,"includes",function(a,i){return(i=i||0)<0&&(i=this.length+i),this.some(function(e,t){return i<=t&&(n=e,r=a,Number.isNaN(n)?Number.isNaN(r):n===r);var n,r})});var n=Element.prototype;t(n,"matches",n.msMatchesSelector||n.webkitMatchesSelector),t(n,"closest",function(e){var t=this;do{if(t.matches(e))return t;t="svg"===t.tagName?t.parentNode:t.parentElement}while(t);return null}),t(HTMLCanvasElement.prototype,"toBlob",function(a,i,o){var c=this;setTimeout(function(){for(var e=atob(c.toDataURL(i,o).split(",")[1]),t=e.length,n=new Uint8Array(t),r=0;r<t;r++)n[r]=e.charCodeAt(r);a(new Blob([n],{type:i||"image/png"}))})});var r=Object.freeze({});var a=Object.freeze({clamp:function(e,t,n){return Math.max(t,Math.min(e,n))},lerp:function n(e,r,a){return Array.isArray(e)?e.map(function(e,t){return n(e,r[t],a)}):(1-a)*e+a*r}});function u(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}function b(e,t,n){return Math.abs((t[0]-e[0])*(n[1]-e[1])-(n[0]-e[0])*(t[1]-e[1]))/2}function l(e,t,n){var r=u(t,n),a=u(n,e),i=u(e,t),o=r+a+i,c=o/2;return{r:b(e,t,n)/c,c:[(r*e[0]+a*t[0]+i*n[0])/o,(r*e[1]+a*t[1]+i*n[1])/o]}}function y(e,t,n,r){var a=l(e,t,n),i=a.c,o=(a.r+r)/a.r;function c(e){var t=e[0]-i[0],n=e[1]-i[1];return[t*o+i[0],n*o+i[1]]}return[c(e),c(t),c(n)]}var i=Object.freeze({distance:u,rotatePoint:function(e,t){var n=e[0],r=e[1],a=Math.cos(t),i=Math.sin(t);return[a*n-i*r,i*n+a*r]},angleBetween:function(e,t,n){function r(e){return e*e}var a=void 0;if(n){var i=r(t[0]-e[0])+r(t[1]-e[1]),o=r(t[0]-n[0])+r(t[1]-n[1]),c=r(n[0]-e[0])+r(n[1]-e[1]);a=Math.acos((i+o-c)/Math.sqrt(4*i*o))}else{var u=t[0]-e[0],l=t[1]-e[1];a=Math.atan2(l,u)}return a},triangleArea:b,triangleIncircle:l,expandTriangle:y});function o(e,t){var n=(t=t||document).querySelectorAll(e);return Array.from(n)}function c(e,t,n){var r=e.split(/([#\.])/);if(1<r.length){e=r[0]||"div",n=n||{};for(var a=1;a<r.length-1;a++){var i=r[a],o=r[a+1];"#"===i?n.id=o:n.class=n.class?n.class+" "+o:o,a++}}var c=t?document.createElementNS(t.namespaceURI,e):document.createElement(e);if(n)for(var u in n)c.setAttribute(u,n[u]);return t&&t.appendChild(c),c}function f(e,t,n){e.addEventListener(t,n,!1)}function s(e,r,a){(a=a||{}).autoRevoke;function n(e){if(e){e=Array.from(e);var t=a.acceptedTypes;if(t&&(e=e.filter(function(e){return t.includes(e.type)})),e.length){var n=e.map(i);r(n)}}}function i(e){return{url:URL.createObjectURL(e),file:e}}"INPUT"===e.nodeName&&"file"===e.type?f(e,"change",function(e){var t=e.currentTarget;t.files&&n(t.files)}):(f(e,"dragover",function(e){return e.preventDefault()}),f(e,"drop",function(e){e.preventDefault(),n(e.dataTransfer.files)}))}function h(t){return function(e){t(e[0])}}var v=Object.freeze({$$:o,$$1:function(e,t){return(t=t||document).querySelector(e)},createElement:c,relativeMousePos:function(e,t,n){function r(e,t,n){return Math.max(t,Math.min(e,n))}var a=t.getBoundingClientRect(),i=e.clientX-a.left,o=e.clientY-a.top;return n&&(i=r(i,0,a.width),o=r(o,0,a.height)),[i,o]},addEvent:f,live:function(e,a,i){document.addEventListener(e,function(e){var t=o(a);if(t&&t.length){for(var n=e.target,r=-1;n&&-1===(r=t.indexOf(n));)n=n.parentElement;-1<r&&i.call(n,e)}})},animate:function(a,i,o){var c=void 0,u=void 0;return requestAnimationFrame(function e(t){c||(c=t);var n=(t-c)/a,r=n%1;o&&Math.trunc(n)%2&&(r=1-r),i(r,n),u||requestAnimationFrame(e)}),{cancel:function(){u=!0}}},dropFiles:s,dropFile:function(e,t){s(e,h(t))},dropImage:function(e,t){s(e,h(t),{acceptedTypes:["image/png","image/jpeg","image/gif","image/svg","image/svg+xml"]})}}),d=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),w=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{!r&&c.return&&c.return()}finally{if(a)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};var m=function(){function r(e,t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.w=e.width=t||e.width,this.h=e.height=n||e.height,this.targetContext=e.getContext("2d"),this.targetData=this.targetContext.getImageData(0,0,this.w,this.h)}return d(r,[{key:"setPixel",value:function(e,t,n){var r=4*(t*this.w+e),a=this.targetData.data;a[r]=n[0],a[r+1]=n[1],a[r+2]=n[2],a[r+3]=3<n.length?n[3]:255}},{key:"render",value:function(){this.targetContext.putImageData(this.targetData,0,0)}}]),r}(),p=Object.freeze({drawImageTriangle:function(e,t,n,r,a,i,o,c,u){function l(e,t,n,r,a,i,o,c,u){var l=((i-u)*(t-a)-(n-i)*(a-c))/((r-o)*(t-a)-(e-r)*(a-c)),f=((i-u)*(e-r)-(n-i)*(r-o))/((a-c)*(e-r)-(t-a)*(r-o));return[l,f,n-e*l-t*f]}if(u){var f,s,h,v,d=b(i,o,c),m=b(n,r,a);f=y(i,o,c,.3),i=(s=w(f,3))[0],o=s[1],c=s[2],h=y(n,r,a,.3*m/d),n=(v=w(h,3))[0],r=v[1],a=v[2]}var p=l(n[0],n[1],i[0],r[0],r[1],o[0],a[0],a[1],c[0]),g=l(n[0],n[1],i[1],r[0],r[1],o[1],a[0],a[1],c[1]);t.save(),t.setTransform(p[0],g[0],p[1],g[1],p[2],g[2]),t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(r[0],r[1]),t.lineTo(a[0],a[1]),t.closePath(),t.clip(),t.drawImage(e,0,0,e.width,e.height),t.restore()},CanvasPixelBuffer:m}),g={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},M=/([astvzqmhlc])([^astvzqmhlc]*)/gi;var x=Object.freeze({parsePath:function(e){var i=[];return e.replace(M,function(e,t,n){var r,a=t.toLowerCase();for(n=(r=(r=(r=n).replace(/(\.\d+)(?=\.)/g,"$1 ")).match(/-?[.0-9]+(?:e[-+]?\d+)?/gi))?r.map(Number):[],"m"===a&&2<n.length&&(i.push([t].concat(n.splice(0,2))),a="l",t="m"===t?"l":"L");;){if(n.length===g[a])return n.unshift(t),i.push(n);if(n.length<g[a])throw new Error("Malformed path data: "+[t,n]);i.push([t].concat(n.splice(0,g[a])))}}),i},absolutizePath:function(e){var a=0,i=0,o=0,c=0;return e.map(function(e){var t=(e=e.slice())[0],n=t.toUpperCase();if(e.startPoint={x:o,y:c},t!==n)switch(e[0]=n,t){case"a":e[6]+=o,e[7]+=c;break;case"v":e[1]+=c;break;case"h":e[1]+=o;break;default:for(var r=1;r<e.length;)e[r++]+=o,e[r++]+=c}switch(n){case"Z":o=a,c=i;break;case"H":o=e[1];break;case"V":c=e[1];break;case"M":o=a=e[1],c=i=e[2];break;default:o=e[e.length-2],c=e[e.length-1]}return e.endPoint={x:o,y:c},e})},serializePath:function(e){return e.reduce(function(e,t){return e+t[0]+t.slice(1).join(",")},"")}});function T(){var e=new Date,t=("00"+e.getMilliseconds()).substr(-3);return e.toTimeString().split(" ")[0]+"."+t}var A=Object.freeze({printTime:T,log2:function(){var e="["+T()+"]",t=Array.from(arguments);t.unshift(e),console.log.apply(console,t)},alertErrors:function(){window.onerror=function(e,t,n){alert(T()+" - Error message: "+e+"\nURL: "+t+"\nLine Number: "+n)}},logToScreen:function(){var t=c("#abo-log",document.body,{style:"position:fixed;top:0;left:0;z-index:9999;white-space:pre;pointer-events:none;background-color:rgba(255,255,255,.5);"});console._log=console.log,console.log=function(){var e=Array.from(arguments).join(" ");t.textContent=e+"\n"+t.textContent}}});e.Polys=r,e.Math=a,e.Geom=i,e.DOM=v,e.Canvas=p,e.SVG=x,e.Debug=A,e.htmlEncode=function(e){return document.createElement("a").appendChild(document.createTextNode(e)).parentNode.innerHTML},e.htmlDecode=function(e){var t=document.createElement("a");return t.innerHTML=e,t.textContent},e.getQueryVariable=function(e){for(var t=window.location.search.substring(1).split("&"),n=0;n<t.length;n++){var r=t[n].split("=");if(r[0]===e)return r[1]}return!1},Object.defineProperty(e,"__esModule",{value:!0})});